% ouverture de fichier
%fid = fopen('enrUno1206');
fid = fopen('enrDos1206');
%fid = fopen('enrTres1206');

%Partie transformation de données

Datas= fscanf(fid,'%f,%f,%f,%f,%f,%f,%f,%f\n',[8 Inf]); %on lit les données
fclose(fid); % fermeture de fichier
sizeEnr = size(Datas); %dimensions d'enregistrements
GeoDatas=Datas(1:3,:); %on récupère les données géographiques
radianGeoData=[degDectoRad(GeoDatas(1:2,:));GeoDatas(3,:)]; %on transforme les degrés en radianGeoData
cartGeoData=radianGeoData; %initialisation
for i=1:sizeEnr(1,2)
  %on transforme en coordonnées cartésiennes
  [cartGeoData(1,i) cartGeoData(2,i) cartGeoData(3,i)]= ellipToCart(radianGeoData(1,i),radianGeoData(2,i),radianGeoData(3,i));
end
%pointDeRéférence : 48.268948° (latitude), 4.068544° (longitude)
localGeoData=cartGeoData;
for i=1:sizeEnr(1,2)
  %on transforme en coordonnées cartésiennes
  [localGeoData(1,i) localGeoData(2,i) localGeoData(3,i)]= cartToLocal(cartGeoData(1,i),cartGeoData(2,i),cartGeoData(3,i),degDectoRad(4.068544),degDectoRad(48.268948));
end

%Partie affichages d'indicateurs

disp("Nombre moyen de sattellites :");
disp(mean(Datas(4,:)));
disp("Heure GPS de début :");
disp(Datas(5:7,1));
disp("Heure GPS de fin :");
disp(Datas(5:7,sizeEnr(1,2)));
disp("Ecart moyen (en secondes) entre 2 enregistrements selon GPS (comparé aux 5 secondes réelles) :");
ecarts=zeros(1,sizeEnr(1,2)-1);
for i=1:sizeEnr(1,2)-1
  ecarts(i)=Datas(7,i+1)-Datas(7,i);
  %Passage d'une minute à une autre
  if(ecarts(i) < -40)
    ecarts(i) = ecarts(i) +60;
  end
end
disp(mean(ecarts));
disp("Hdop moyen :");
disp(mean(Datas(8,:)));

distancesFromRef=zeros(1,sizeEnr(1,2));
for i=1:sizeEnr(1,2)
  distancesFromRef(i) = norm(localGeoData(1,i)+localGeoData(2,i));
end
disp("Distance (en mètres sans prendre en compte l'altitude) moyenne par rapport au point de référence :");
disp(mean(distancesFromRef));
disp("Ecart type de ces distances (en mètres) :");
disp(sqrt(var(distancesFromRef)));


disp("altitude moyenne (en mètres) :");
disp(mean(Datas(3,:)));

ecartsPositions=zeros(1,sizeEnr(1,2)-1);
for i=1:sizeEnr(1,2)-1
  ecartsPositions(i) = norm(localGeoData(1,i)-localGeoData(1,i+1)+localGeoData(2,i)-localGeoData(2,i+1));
end
disp('Ecart (distance) moyen entre chaque position (en mètres) :');
disp(mean(ecartsPositions));

%Autocorrélation
test=xcorr(distancesFromRef);
figure;
plot(1:length(test),test);